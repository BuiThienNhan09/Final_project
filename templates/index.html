<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight AI Web3</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="bg-animation"></div>
    
    <div class="container">
        <div class="header">
            <div class="logo">‚úàÔ∏è AI FLIGHT</div>
            <h1>D·ª∞ B√ÅO GI√Å V√â <span class="neon-text">T∆Ø∆†NG LAI</span></h1>
            <p>H·ªá th·ªëng ph√¢n t√≠ch d·ªØ li·ªáu h√†ng kh√¥ng Real-time</p>
            <p id="rateNote" class="small text-muted">{% if exchange_rate %}T·ª∑ gi√° tham chi·∫øu: {{ exchange_rate }} (c√≥ th·ªÉ thay ƒë·ªïi b·∫±ng bi·∫øn m√¥i tr∆∞·ªùng <code>EXCHANGE_RATE_INR_TO_VND</code>){% endif %}</p>
        </div>

        <div class="main-content">
            <form action="/predict" method="POST" class="glass-panel">
                <div class="form-header">üì° THI·∫æT L·∫¨P H√ÄNH TR√åNH</div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>H√£ng h√†ng kh√¥ng</label>
                        <select name="airline">
                            <option value="Vistara">Vistara</option>
                            <option value="Air_India">Air India</option>
                            <option value="Indigo">Indigo</option>
                            <option value="GO_FIRST">GO FIRST</option>
                            <option value="AirAsia">AirAsia</option>
                            <option value="SpiceJet">SpiceJet</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>H·∫°ng v√©</label>
                        <select name="flight_class">
                            <option value="Economy">Ph·ªï th√¥ng (Economy)</option>
                            <option value="Business">Th∆∞∆°ng gia (Business)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ƒêi·ªÉm xu·∫•t ph√°t</label>
                        <select name="source_city">
                            <option value="Delhi">Delhi</option>
                            <option value="Mumbai">Mumbai</option>
                            <option value="Bangalore">Bangalore</option>
                            <option value="Kolkata">Kolkata</option>
                            <option value="Hyderabad">Hyderabad</option>
                            <option value="Chennai">Chennai</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ƒêi·ªÉm ƒë·∫øn</label>
                        <select name="destination_city">
                            <option value="Mumbai">Mumbai</option>
                            <option value="Delhi">Delhi</option>
                            <option value="Bangalore">Bangalore</option>
                            <option value="Kolkata">Kolkata</option>
                            <option value="Hyderabad">Hyderabad</option>
                            <option value="Chennai">Chennai</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Gi·ªù c·∫•t c√°nh</label>
                        <select name="departure_time">
                            <option value="Morning">S√°ng (Morning)</option>
                            <option value="Early_Morning">S√°ng s·ªõm</option>
                            <option value="Evening">T·ªëi</option>
                            <option value="Night">ƒê√™m</option>
                            <option value="Afternoon">Chi·ªÅu</option>
                            <option value="Late_Night">ƒê√™m mu·ªôn</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Gi·ªù h·∫° c√°nh</label>
                        <select name="arrival_time">
                            <option value="Night">ƒê√™m</option>
                            <option value="Evening">T·ªëi</option>
                            <option value="Morning">S√°ng</option>
                            <option value="Afternoon">Chi·ªÅu</option>
                            <option value="Early_Morning">S√°ng s·ªõm</option>
                            <option value="Late_Night">ƒê√™m mu·ªôn</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label>S·ªë ƒëi·ªÉm d·ª´ng: <select name="stops" style="width: auto; display: inline-block; padding: 5px;">
                            <option value="zero">Bay th·∫≥ng (0)</option>
                            <option value="one">1 tr·∫°m d·ª´ng</option>
                            <option value="two_or_more">2+ tr·∫°m d·ª´ng</option>
                        </select></label>
                    </div>

                    <div class="form-group full-width">
                        <label>ƒê·∫∑t tr∆∞·ªõc bao nhi√™u ng√†y? (<span id="daysDisplay">20</span> ng√†y)</label>
                        <input type="range" name="days_left" min="1" max="50" value="20" class="slider" oninput="document.getElementById('daysDisplay').innerText = this.value">
                    </div>

                    <div class="form-group full-width">
                        <label>Th·ªùi gian bay d·ª± ki·∫øn: <span id="durDisplay">2.5</span> gi·ªù</label>
                        <input type="number" name="duration" value="2.5" step="0.5" min="0.5" class="input-number" oninput="document.getElementById('durDisplay').innerText = this.value">
                    </div>
                </div>

                <div style="margin-top:12px; display:flex; gap:12px; align-items:center;">
                    <div>
                        <label class="small">T·ª∑ gi√° INR ‚Üí VND (t√πy ch·ªçn)</label>
                        <input type="number" name="exchange_rate" step="0.01" min="0" class="form-control" value="{{ exchange_value if exchange_value is defined else '287.5' }}">
                    </div>
                    <div style="flex:1"></div>
                    <button id="refreshRate" type="button" class="btn btn-outline-secondary">L·∫•y t·ªâ gi√° m·ªõi</button>
                    <button type="submit" class="cyber-btn">‚ö° PH√ÇN T√çCH NGAY</button>
                </div>
            </form>

            <script>
            // Fetch latest rate from server and update the input and note text
            document.getElementById('refreshRate').addEventListener('click', function(){
                const btn = this; btn.disabled = true; btn.innerText = 'ƒêang l·∫•y...';
                fetch('/rate').then(r=>r.json()).then(data => {
                    if (data && data.rate) {
                        const rate = parseFloat(data.rate);
                        const input = document.querySelector('input[name=exchange_rate]');
                        if (input) input.value = rate.toFixed(2);
                        const note = document.getElementById('rateNote');
                        if (note) note.innerText = `T·ª∑ gi√° tham chi·∫øu: 1 INR = ${rate.toFixed(2)} VND`;
                    } else if (data && data.error) {
                        alert('Kh√¥ng th·ªÉ l·∫•y t·ªâ gi√°: ' + data.error);
                    }
                }).catch(err => {
                    console.error(err); alert('L·ªói khi l·∫•y t·ªâ gi√° m·ªõi.');
                }).finally(()=>{ btn.disabled = false; btn.innerText = 'L·∫•y t·ªâ gi√° m·ªõi'; });
            });
            </script>

            {% if show_result %}
            <div class="result-box glass-panel">
                <h3>K·∫æT QU·∫¢ D·ª∞ B√ÅO</h3>
                <div class="price-tag">{{ prediction_text }}</div>
                <div class="advice-tag {{ advice_class }}">{{ advice_text }}</div>
                <p class="confidence">ƒê·ªô ch√≠nh x√°c m√¥ h√¨nh: 96%</p>
            </div>
            {% endif %}
        </div>
    </div>
</body>
</html>